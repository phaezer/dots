#=== vars ===
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

# === general ===
set-option -g allow-passthrough on

#=== Mouse ===
set -g mouse on

#=== Status bar ===
set-option -g status-position top

#=== Shell management ===
set -g default-shell ${SHELL}
set -g default-command ${SHELL}

# #=== bells ===
# don't do anything when a 'bell' rings
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity off
set -g bell-action none
setw -g mode-keys vi

#=== nested ===
# Use ^b b to send the leader to a nested session.
bind-key b send-prefix

#=== keyboard ===
# Don't wait for an escape sequence after hitting Esc.
# fixes insert mode exit lag in vim.
set -sg escape-time 0

# === Windows ===
# Allow window renaming so we get nicer icons
set -g allow-rename on
# move windows
bind-key left run 'tmux swap-window -d -t #{e|-|:#I,1}'
bind-key right run 'tmux swap-window -d -t #{e|+|:#I,1}'

# === nvim integration ===
set -g @tmux-nvim-condition "(ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iE '^[^TXZ ]+ +(\\S+\\/)?g?\.?(view|n?vim?x?)(-wrapped)?(diff)?$'; tmux display-message -p '#{pane_title}' \
    | grep -iE '[: ]n?vim?$') | grep -qE ."

# SRC: https://github.com/alexghergh/nvim-tmux-navigation
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'

# choose-tree binding 
# idea came from SRC: https://waylonwalker.com/tmux-choose-tree/##bind-key+j+choose-tree+-swZ)
bind-key j choose-tree -swZ

#=== clipboard ===
setw -g mode-keys vi
# Setup 'v' begin/end selection as in Vim.
bind-key -T copy-mode-vi v send-keys -X begin-selection

#=== plugins ===
set -g @plugin 'tmux-plugins/tpm'

set -g @plugin 'tmux-plugins/tmux-sensible'     # A set of tmux options that should be acceptable to everyone.
set -g @plugin 'tmux-plugins/tmux-yank'         # Cross-platform support for clipboard.
set -g @plugin 'tmux-plugins/tmux-resurrect'    # Save/Restore sessions
set -g @plugin 'tmux-plugins/tmux-continuum'    # continuos saving of tmux session in the bg
set -g @plugin 'tmux-plugins/tmux-logging'      # Logging for tmux.
set -g @plugin 'tmux-plugins/tmux-pain-control' # better pane control
set -g @plugin 'b0o/tmux-autoreload'            # watches your tmux configuration file and automatically reloads it on change.
set -g @plugin 'Morantron/tmux-fingers'         # Easy copy mode with mouse-free selection.
set -g @plugin 'sainnhe/tmux-fzf'               # Fuzzy finder for tmux.
set -g @plugin 'noscript/tmux-mighty-scroll'    # seamless scrolling

set -g @plugin 'jaclu/tmux-menus'               # Cuz i'm a noob, open with prefix + space
set -g @menus_config_file '~/.config/tmux/tmux.conf'
set -g @menus_trigger 'Space'

# set -g @plugin 'anghootys/tmux-ip-address'     # provides pub ip address
# set -g @plugin 'erikw/tmux-powerline'

set -g @plugin 'tmux-plugins/tmux-continuum'   # Auto Save/Restore
set -g @continuum-restore 'on'                 # Restore using continuum.

set -g @plugin 'fabioluciano/tmux-tokyo-night'
set -g @theme_variation 'storm'
set -g @theme_transparent_status_bar 'true'
set -g @theme_left_separator '▌'
set -g @theme_right_separator '▐'
set -g @theme_transparent_left_separator_inverse '▐'
set -g @theme_transparent_right_separator_inverse '▌'
set -g @theme_active_pane_border_style '#737aa2'
set -g @theme_inactive_pane_border_style '#292e42'
set -g @theme_window_with_activity_style 'italics'
set -g @theme_status_bell_style 'bold'
set -g @theme_plugins 'datetime,weather,spt'
set -g @theme_plugin_datetime_icon ''
# set -g @theme_plugin_datetime_accent_color
# set -g @theme_plugin_datetime_accent_color_icon
# set -g @theme_plugin_datetime_format
set -g @theme_plugin_weather_icon '󰖙'
# set -g @theme_plugin_weather_accent_color
# set -g @theme_plugin_weather_accent_color_icon
set -g @theme_plugin_weather_format '%t+H:%h'

run '~/.tmux/plugins/tpm/tpm'
